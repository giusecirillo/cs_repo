- name: Create a VM from a template
  vmware_guest:
    validate_certs: no
    folder: "{{ vcenter_datacenter }}/vm"
    template: "{{ vm_template }}"
    name: "{{ inventory_hostname }}"
    esxi_hostname: "{{ esxi_hostname }}"
    datacenter: "{{ vcenter_datacenter }}"
    state: poweredon
    guest_id: "{{ vm_guest_id }}"
    customization:
      hostname: "{{ inventory_hostname }}"
      dns_servers: "{{ dns_servers }}"
      dns_suffix: "{{ dns_domain }}"
      domain: "{{ dns_domain }}"
    disk: "{{ vm_disks }}"
    hardware:
      memory_mb: "{{ vm_memory_mb }}"
      num_cpus: "{{ vm_num_cpus }}"
      num_cpu_cores_per_socket: "{{ vm_cpu_cores_per_socket }}"
      hotadd_cpu: true
      hotadd_memory: true
    networks: "{{ vm_networks }}"
    wait_for_ip_address: yes
